name: Version Check

on:
  pull_request:
    branches: [ main, dev ]
  push:
    branches: [ main, dev ]

jobs:
  check-version:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Check version consistency
        run: |
          # Get version from src/__init__.py (portable way)
          VERSION=$(grep '__version__' src/__init__.py | sed 's/__version__ = "\(.*\)"/\1/')
          echo "Version in src/__init__.py: $VERSION"
          
          # Check if version follows semver (with optional -vN suffix for hotfixes)
          if ! echo "$VERSION" | grep -qE '^[0-9]+\.[0-9]+\.[0-9]+(-v[0-9]+)?$'; then
            echo "❌ Version doesn't follow semver format (X.Y.Z or X.Y.Z-vN): $VERSION"
            exit 1
          fi
          
          echo "✅ Version format is valid: $VERSION"
          
          # Check if there's a changelog for this version
          if [ ! -f "changelogs/CHANGELOG_v${VERSION}.md" ]; then
            echo "⚠️  Warning: No changelog found for version $VERSION"
            echo "   Expected: changelogs/CHANGELOG_v${VERSION}.md"
            echo "   This is not a failure, but consider adding a changelog."
          else
            echo "✅ Changelog exists for version $VERSION"
          fi
